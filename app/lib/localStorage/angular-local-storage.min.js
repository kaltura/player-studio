(function(){var e=angular.module("LocalStorageModule",[]);e.value("prefix","ls"),e.constant("cookie",{expiry:30,path:"/"}),e.constant("notify",{setItem:!0,removeItem:!1}),e.service("localStorageService",["$rootScope","prefix","cookie","notify",function(e,o,t,r){"."!==o.substr(-1)&&(o=o?o+".":"");var a=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(o){return e.$broadcast("LocalStorageModule.notification.error",o.message),!1}},n=function(t,n){if(!a())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),r.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:n,storageType:"cookie"}),g(t,n);"undefined"==typeof n&&(n=null);try{(angular.isObject(n)||angular.isArray(n))&&(n=angular.toJson(n)),localStorage.setItem(o+t,n),r.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:n,storageType:"localStorage"})}catch(i){return e.$broadcast("LocalStorageModule.notification.error",i.message),g(t,n)}return!0},i=function(t){if(!a())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),d(t);var r=localStorage.getItem(o+t);return r&&"null"!==r?"{"===r.charAt(0)||"["===r.charAt(0)?angular.fromJson(r):r:null},c=function(t){if(!a())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),r.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"}),f(t);try{localStorage.removeItem(o+t),r.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"localStorage"})}catch(n){return e.$broadcast("LocalStorageModule.notification.error",n.message),f(t)}return!0},l=function(){if(!a())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var t=o.length,r=[];for(var n in localStorage)if(n.substr(0,t)===o)try{r.push(n.substr(t))}catch(i){return e.$broadcast("LocalStorageModule.notification.error",i.Description),[]}return r},u=function(){if(!a())return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),S();var t=o.length;for(var r in localStorage)if(r.substr(0,t)===o)try{c(r.substr(t))}catch(n){return e.$broadcast("LocalStorageModule.notification.error",n.message),S()}return!0},s=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(o){return e.$broadcast("LocalStorageModule.notification.error",o.message),!1}},g=function(r,a){if("undefined"==typeof a)return!1;if(!s())return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var n="",i=new Date;null===a?(i.setTime(i.getTime()+-864e5),n="; expires="+i.toGMTString(),a=""):0!==t.expiry&&(i.setTime(i.getTime()+24*t.expiry*60*60*1e3),n="; expires="+i.toGMTString()),r&&(document.cookie=o+r+"="+encodeURIComponent(a)+n+"; path="+t.path)}catch(c){return e.$broadcast("LocalStorageModule.notification.error",c.message),!1}return!0},d=function(t){if(!s())return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var r=document.cookie.split(";"),a=0;a<r.length;a++){for(var n=r[a];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(o+t+"="))return decodeURIComponent(n.substring(o.length+t.length+1,n.length))}return null},f=function(e){g(e,null)},S=function(){for(var e=null,t=o.length,r=document.cookie.split(";"),a=0;a<r.length;a++){for(e=r[a];" "==e.charAt(0);)e=e.substring(1,e.length);key=e.substring(t,e.indexOf("=")),f(key)}};return{isSupported:a,set:n,add:n,get:i,keys:l,remove:c,clearAll:u,cookie:{set:g,add:g,get:d,remove:f,clearAll:S}}}])}).call(this);