"use strict";angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(t,s,u){return{require:"?ngModel",link:function(n,o,e,i){var l;function a(n,o){return o&&"function"==typeof o?function(e,t){n(e,t),o(e,t)}:n}var r={},c={receive:null,remove:null,start:null,stop:null,update:null};angular.extend(r,t),i?(n.$watch(e.ngModel+".length",function(){s(function(){o.sortable("refresh")})}),c.start=function(e,t){t.item.sortable={index:t.item.index(),cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},_isCanceled:!1}},c.activate=function(){l=o.contents();var e=o.sortable("option","placeholder");if(e&&e.element&&"function"==typeof e.element){var t=e.element();t.jquery||(t=angular.element(t));var n=o.find('[class="'+t.attr("class")+'"]');l=l.not(n)}},c.update=function(e,t){t.item.sortable.received||(t.item.sortable.dropindex=t.item.index(),t.item.sortable.droptarget=t.item.parent(),o.sortable("cancel")),"clone"===o.sortable("option","helper")&&(l=l.not(l.last())),l.appendTo(o),t.item.sortable.received&&!t.item.sortable.isCanceled()&&n.$apply(function(){i.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},c.stop=function(e,t){!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()?n.$apply(function(){i.$modelValue.splice(t.item.sortable.dropindex,0,i.$modelValue.splice(t.item.sortable.index,1)[0])}):"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()||"clone"===o.sortable("option","helper")||l.appendTo(o)},c.receive=function(e,t){t.item.sortable.received=!0},c.remove=function(e,t){t.item.sortable.isCanceled()||n.$apply(function(){t.item.sortable.moved=i.$modelValue.splice(t.item.sortable.index,1)[0]})},n.$watch(e.uiSortable,function(e){angular.forEach(e,function(e,t){c[t]&&("stop"===t&&(e=a(e,function(){n.$apply()})),e=a(c[t],e)),o.sortable("option",t,e)})},!0),angular.forEach(c,function(e,t){r[t]=a(e,r[t])})):u.info("ui.sortable: ngModel not provided!",o),o.sortable(r)}}}]);